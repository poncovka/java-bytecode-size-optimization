
\subsubsection{Optimalizace větví a skoků}


% neobsahuje skoky, které lze rozhodnout z parametrů - většinou
% LOAD VAR(0); LOAD VAR(0); IFEQ LABEL(0);
% GOTO LABEL(0); GOTO LABEL(1);
% switch
% GOTO LABEL(0); LABEL(0); 
% IFNULL LABEL(0); GOTO LABEL(1);
%IFNE LABEL(0); GOTO LABEL(1);
% LABEL(0); RETURN;
% LABEL(0); GOTO LABEL(1);
% výpočet společných podvýrazů před větvěním
% přesun společného kódu před a za větvení



\begin{tpatterns}

  \code{}
& \code{}
& \desc{} \\

  \code{}
& \code{}
& \desc{} \\

  \code{}
& \code{}
& \desc{} \\

  \code{}
& \code{}
& \desc{} \\


\end{tpatterns}

\begin{itemize}
\item Nahrazení instrukcí LOOKUPSWICH a TABLESWICH za sekvenci IF. Nahrazení je výhodné, jen pokud nejsou skoky příliš velké.
\begin{itemize}
\item LOOKUPSWITCH LABEL(0) I I LABEL(1) LABEL(2); 
\item LOOKUPSWITCH LABEL(0) I LABEL(1); 
\item LOOKUPSWITCH LABEL(0); 
\item TABLESWITCH I I LABEL(0) LABEL(1) LABEL(1) LABEL(1); 
\item TABLESWITCH I I LABEL(0) LABEL(1); 
\end{itemize}

\item Odstranění zbytečných skoků:
\begin{itemize}
\item GOTO LABEL(0); LABEL(0); 
\end{itemize}

\item Odstranění skoků na skoky.
\begin{itemize}
\item LABEL(0); GOTO LABEL(1);
\end{itemize}

\item Odstranění zbytečných porovnávání.
\begin{itemize}
\item LOAD VAR(0); LOAD VAR(0); IFEQ LABEL(0);
\item LOAD VAR(0); LOAD VAR(0); IFNE LABEL(0);
\item IF LABEL(0); GOTO LABEL(0);
\item GOTO LABEL(0); ... ; LABEL(0); RETURN;
\item CONST; CONST; IF LABEL(0); - 0 výskytů
\item CONST null; IFNULL LABEL(0); - 0 výskytů
\item LABEL(0); GOTO LABEL(0);  - 0 výskytů
\end{itemize}

\item Odstranění instrukcí mezi GOTO a nejbližším návěštím.
\begin{itemize}
\item GOTO LABEL(0); GOTO LABEL(1);
\end{itemize}

\item Odstranění instrukcí mezi RETURN a nejbližším návěštím.
\begin{itemize}
\item RETURN; CONST I;
\item RETURN; CONST null;
\item RETURN; GOTO LABEL(0);
\item RETURN; NOP;
\end{itemize}

\end{itemize}

\subsubsection{Nahrazení číselých konstant a zjednodušení algebraických operací}
% nahrazení LDC
% ze sčítání na inc
% CONST I(0); SHR;
% CONST I(0); ADD;
% použít existující konstanty a přetypování?

\begin{itemize}
\item Pro číselné konstanty používat co nejkratší varianty instrukcí.

\item Pokud je to výhodné, pak lze konstantu nahradit kratším zápisem jiného typu a přetypovat.
\begin{itemize}
\item LDC I(0); $\rightarrow$ ICONST\_0;
\item LDC F(3.0); $\rightarrow$	ICONST\_3; i2f;
\item LDC L(31); $\rightarrow$	BIPUSH I(31); i2l;
\item LDC D(-1.0); $\rightarrow$ ICONST\_m1; i2d;
\item LDC D(NaN); $\rightarrow$	DCONST\_0; DUP2; DDIV;
\end{itemize}

\item Provedení operací, které nemají žádný efekt, je zbytečné a instrukce lze odstranit.
\begin{itemize}
\item CONST I(0); ADD;
\item CONST I(0); SHL;
\item CONST I(0); SHR;
\end{itemize}

\item Kde to lze je výhodnější použít specializovanou operaci pro inkrementaci.
\begin{itemize}
\item LOAD VAR(0); CONST I(0); ADD; STORE VAR(0); $\rightarrow$ INC VAR(0) I(0);
\end{itemize}

\end{itemize}

\subsubsection{Optimalizace práce se zásobníkem}
% *, pop, *, return, nop, dup
% duplikace stejných hodnot pomocí dup
% LOAD VAR; NEW OBJECT; DUP_X1; SWAP;
% POP2; RETURN;
% LOAD VAR; LOAD this; SWAP;
% PUTSTATIC OBJECT(0) FIELD(0); GETSTATIC OBJECT(0) FIELD(0); 
% STORE VAR(0); LOAD VAR(0); POP; 
% STORE VAR(0); LOAD VAR(0); RETURN; 
% STORE VAR(0); LOAD VAR(0); 

\begin{itemize}
\item Odstranění instrukcí NOP.

\item Maximalizace využití instrukce DUP ve všech formách.
\begin{itemize}
\item CONST I(0); CONST I(0); $\rightarrow$ CONST I(0); DUP;
\item LOAD VAR(0); LOAD VAR(0); $\rightarrow$ LOAD VAR(0); DUP;
\item STORE VAR(0); LOAD VAR(0); $\rightarrow$ DUP; STORE VAR(0);
\item PUTSTATIC OBJECT(0) FIELD(0); GETSTATIC OBJECT(0) FIELD(0); $\rightarrow$ DUP; PUTSTATIC OBJECT(0) FIELD(0);
\item LOAD VAR(0); LOAD VAR(1); LOAD VAR(0); $\rightarrow$ LOAD VAR(1); LOAD VAR(0); DUP\_X;
\item LOAD VAR(0); LOAD VAR(1); LOAD VAR(0); LOAD VAR(1); $\rightarrow$ LOAD VAR(0); LOAD VAR(1); DUP2;
\end{itemize}

\item Provedení instrukcí POP.
\begin{itemize}
\item CONST null; POP;
\item LOAD VAR; POP;
\item GETFIELD OBJECT FIELD; POP; $\rightarrow$ POP;
\item GETSTATIC OBJECT FIELD; POP; $\rightarrow$ POP;
\end{itemize}

\item Provedení instrukce SWAP.
\begin{itemize}
\item LOAD VAR; LOAD this; SWAP; $\rightarrow$ LOAD this; LOAD VAR;
\item LOAD PAR; NEW OBJECT; DUP\_X1; SWAP; $\rightarrow$ NEW OBJECT; DUP; LOAD PAR;
\end{itemize}

\item Odstranění instrukcí pro manipulaci se zásobníkem před instrukcí RETURN, která nic nevrací.
\begin{itemize}
\item POP; RETURN;
\item STORE VAR(0); LOAD VAR(0); RETURN; 
\end{itemize}

\end{itemize}


\subsubsection{Optimalizace konkatenace řetězců}
% konkatenace dvou řetězcových konstant před append
% pr8zdný řetězec
% Volání bezparametrické metody.
% String builder, append

\begin{itemize}
\item Nejčastěji volanou metodou je append třídy StringBuilder s parametrem String.
\item Append prázdného řetězce je zbytečná operace.
\item Využití parametrického konstruktoru třídy StringBuilder. Ušetří se jedno append.
\item Opakované volání append pro řetězcové konstanty lze sloučit do jednoho volání pro jejich konkatenaci.
\item Tisk prázného řetězce je zbytečná operace.
\end{itemize}

\subsubsection{Optimalizace práce s objekty}
% CONST null; CHECKCAST ARRAY;
% CHECKCAST OBJECT(0); CHECKCAST OBJECT(0); 
% CONST null; ATHROW;

\begin{itemize}
\item CONST null; CHECKCAST ARRAY;
\item CHECKCAST OBJECT(0); CHECKCAST OBJECT(0); 
\item CONST null; ATHROW;
\end{itemize}

\subsubsection{Optimalizace bajtkódu}
% copy propagration
% constant folding and constant propagation
% algebraic simplification and reduction
% flow of control optimization
% dead code elimination - never executed and does nothing useful
% loop unrolling - spíše ne

\begin{itemize}
\item copy propagration
\item constant folding and constant propagation
\item algebraic simplification and reduction
\item flow of control optimization
\item dead code elimination - never executed and does nothing useful
\item loop unrolling - spíše ne
\end{itemize}


%=========================================================================

